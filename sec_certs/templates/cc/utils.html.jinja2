{% macro keywords_card(keyword_scan, doc_prefix, card_id, card_name, keyword_sources, hidden) %}
	{% set ns = namespace(render=False) %}
	{% for heading, keyword in keyword_sources.items() %}
		{% if keyword not in hidden and keyword_scan[keyword] %}
			{% set ns.render = True %}
		{% endif %}
	{% endfor %}
	{% if ns.render %}
		<div class="card mt-1">
			<div class="card-header" id="{{ doc_prefix }}-{{ card_id }}-head">
			<h4 class="mb-0">
				<button class="btn btn-link" data-toggle="collapse" data-target="#{{ doc_prefix }}-{{ card_id }}-card" aria-expanded="false" aria-controls="{{ doc_prefix }}-{{ card_id }}-card">
				{{ card_name }}
				</button>
			</h4>
			</div>

			<div id="{{ doc_prefix }}-{{ card_id }}-card" class="collapse" aria-labelledby="{{ doc_prefix }}-{{ card_id }}-head">
			<div class="card-body">
				{% for heading, keyword in keyword_sources.items() %}
					{% if keyword not in hidden and keyword_scan[keyword] %}
						<h5 class="mt-2">{{ heading }}</h5>
						{{ double_join(keyword_scan[keyword]) }}
					{% endif %}
				{% endfor %}
			</div>
			</div>
		</div>
	{% endif %}
{% endmacro %}

{% macro cryptography_keywords(keyword_scan, doc_prefix, hidden=[]) -%}
	{{ keywords_card(keyword_scan, doc_prefix, "crypto", "Cryptography", {"Algorithms": "rules_crypto_algs",
																		  "Engines": "rules_crypto_engines",
																		  "Libraries": "rules_crypto_libraries",
																		  "Elliptic Curves": "rules_ecc_curves"}, hidden) }}
{%- endmacro %}

{% macro device_keywords(keyword_scan, doc_prefix, hidden=[]) -%}
	{{ keywords_card(keyword_scan, doc_prefix, "device", "Device", {"Device ID": "rules_device_id",
																	"JavaCard": "rules_javacard",
																	"OS": "rules_os",
																	"CPLC": "rules_cplc"}, hidden) }}
{%- endmacro %}

{% macro security_keywords(keyword_scan, doc_prefix, hidden=[]) -%}
	{{ keywords_card(keyword_scan, doc_prefix, "security", "Security", {"Protection profiles": "rules_protection_profiles",
																		"Security Assurance Requirements (SAR)": "rules_security_assurance_components",
																		"Security Functional Requirements (SFR)": "rules_security_functional_components",
																		"Security level": "rules_security_level"}, hidden) }}
{%- endmacro %}

{% macro other_keywords(keyword_scan, doc_prefix, hidden=[]) -%}
	{{ keywords_card(keyword_scan, doc_prefix, "other", "Other", {"Standards": "rules_standard_id",
																  "Technical reports": "rules_technical_reports"}, hidden) }}
{%- endmacro %}

{% macro double_join(rule_dict, separator=", ") %}
	{% for value in rule_dict.values() %}
		{{ value|join(separator) }}
		{%- if not loop.last -%}{{ separator }}{%- endif -%}
	{% endfor %}
{%- endmacro %}

{% macro render_status(status) %}
	{% if status == "active" %}
	<span class="text-success"><i class="fas fa-check-square"></i> active</span>
	{% elif status == "archived" %}
	<span class="text-warning"><i class="fas fa-times-circle"></i> archived</span>
	{% else %}
	<span>{{ status }}</span>
	{% endif %}
{%- endmacro %}